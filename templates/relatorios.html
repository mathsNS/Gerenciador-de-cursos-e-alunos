{% extends 'base.html' %}
{% block content %}
<div class="card">
  <div class="card-body">
    <h2 class="card-title">Relatórios Acadêmicos</h2>
    <h4 class="mt-4">1. Alunos por Turma</h4>
    {% if rel_turmas %}
      <div class="table-responsive">
      <table class="table table-sm table-striped">
        <thead><tr><th>Turma</th><th>Curso</th><th>Ocupadas</th><th>Vagas</th><th>Alunos</th></tr></thead>
        <tbody>
        {% for r in rel_turmas %}
          <tr>
            <td>{{ r.turma }}</td>
            <td>{{ r.curso }}</td>
            <td>{{ r.ocupadas }}</td>
            <td>{{ r.vagas }}</td>
            <td>{{ r.alunos | length }}</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
      </div>
    {% else %}
      <p><em>Sem dados</em></p>
    {% endif %}

    <h4 class="mt-4">2. Taxa de Aprovação por Turma</h4>
    {% if rel_taxa.por_turma %}
      <div class="table-responsive">
      <table class="table table-sm table-striped">
        <thead><tr><th>Turma</th><th>Curso</th><th>Aprovados</th><th>Total</th><th>Taxa %</th></tr></thead>
        <tbody>
        {% for r in rel_taxa.por_turma %}
          <tr>
            <td>{{ r.turma }}</td>
            <td>{{ r.curso }}</td>
            <td>{{ r.aprovados }}</td>
            <td>{{ r.total }}</td>
            <td><strong>{{ r.taxa }}%</strong></td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
      </div>
    {% else %}
      <p><em>Sem dados</em></p>
    {% endif %}

    <h5 class="mt-3">Taxa de Aprovação por Curso</h5>
    {% if rel_taxa.por_curso %}
      <div class="table-responsive">
      <table class="table table-sm">
        <thead><tr><th>Curso</th><th>Aprovados</th><th>Total</th><th>Taxa %</th></tr></thead>
        <tbody>
        {% for r in rel_taxa.por_curso %}
          <tr>
            <td>{{ r.curso }}</td>
            <td>{{ r.aprovados }}</td>
            <td>{{ r.total }}</td>
            <td><strong>{{ r.taxa }}%</strong></td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
      </div>
    {% endif %}

    <h4 class="mt-4">3. Distribuição de Notas por Turma</h4>
    {% if rel_notas %}
      <div class="table-responsive">
      <table class="table table-sm table-striped">
        <thead><tr><th>Turma</th><th>Curso</th><th>Média</th><th>Mediana</th><th>Desvio Padrão</th><th>Qtd</th></tr></thead>
        <tbody>
        {% for r in rel_notas %}
          <tr>
            <td>{{ r.turma }}</td>
            <td>{{ r.curso }}</td>
            <td>{{ r.media }}</td>
            <td>{{ r.mediana }}</td>
            <td>{{ r.desvio_padrao }}</td>
            <td>{{ r.quantidade }}</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
      </div>
    {% else %}
      <p><em>Sem dados</em></p>
    {% endif %}

    <!-- corrigir! alunos em risco -->
    <h4 class="mt-4">4. Alunos em Risco</h4>
    {% if rel_risco %}
      <div class="table-responsive">
      <table class="table table-sm table-striped table-warning">
        <thead><tr><th>Aluno</th><th>Matrícula</th><th>Turma</th><th>Curso</th><th>Nota</th><th>Frequência</th><th>Motivo</th></tr></thead>
        <tbody>
        {% for r in rel_risco %}
          <tr>
            <td>{{ r.aluno }}</td>
            <td>{{ r.matricula }}</td>
            <td>{{ r.turma }}</td>
            <td>{{ r.curso }}</td>
            <td>{{ r.nota or '-' }}</td>
            <td>{{ r.frequencia or '-' }}%</td>
            <td><small>{{ r.motivo }}</small></td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
      </div>
    {% else %}
      <p><em>Nenhum aluno em risco</em></p>
    {% endif %}

    <!-- corrigir! top alunos -->
    <h4 class="mt-4">5. Top 10 Alunos por CR (Coeficiente de Rendimento)</h4>
    {% if rel_top %}
      <div class="table-responsive">
      <table class="table table-sm table-striped">
        <thead><tr><th>Posição</th><th>Aluno</th><th>Matrícula</th><th>CR</th><th>Cursos Concluídos</th></tr></thead>
        <tbody>
        {% for r in rel_top %}
          <tr>
            <td><strong>{{ loop.index }}</strong></td>
            <td>{{ r.nome }}</td>
            <td>{{ r.matricula }}</td>
            <td><strong style="color: gold;">{{ r.cr }}</strong></td>
            <td>{{ r.cursos_concluidos }}</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
      </div>
    {% else %}
      <p><em>Sem dados</em></p>
    {% endif %}

  </div>
</div>
{% endblock %}
